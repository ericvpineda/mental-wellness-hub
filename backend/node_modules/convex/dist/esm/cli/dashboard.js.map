{
  "version": 3,
  "sources": ["../../../src/cli/dashboard.ts"],
  "sourcesContent": ["import chalk from \"chalk\";\nimport open from \"open\";\nimport {\n  Context,\n  logFailure,\n  logMessage,\n  oneoffContext,\n} from \"../bundler/context.js\";\nimport {\n  deploymentSelectionFromOptions,\n  fetchDeploymentCredentialsProvisionProd,\n  fetchTeamAndProject,\n} from \"./lib/api.js\";\nimport { Command } from \"@commander-js/extra-typings\";\nimport { actionDescription } from \"./lib/command.js\";\n\nconst DASHBOARD_HOST = process.env.CONVEX_PROVISION_HOST\n  ? \"http://localhost:6789\"\n  : \"https://dashboard.convex.dev\";\n\nexport const dashboard = new Command(\"dashboard\")\n  .description(\"Open the dashboard in the browser\")\n  .option(\n    \"--no-open\",\n    \"Don't automatically open the dashboard in the default browser\",\n  )\n  .addDeploymentSelectionOptions(actionDescription(\"Open the dashboard for\"))\n  .showHelpAfterError()\n  .action(async (options) => {\n    const ctx = oneoffContext;\n\n    const deploymentSelection = deploymentSelectionFromOptions(options);\n    const { deploymentName } = await fetchDeploymentCredentialsProvisionProd(\n      ctx,\n      deploymentSelection,\n    );\n\n    if (deploymentName === undefined) {\n      logFailure(\n        ctx,\n        \"No deployment name, run `npx convex dev` to configure a Convex project\",\n      );\n      return await ctx.crash(1, \"invalid filesystem data\");\n    }\n\n    const loginUrl = await deploymentDashboardUrlPage(ctx, deploymentName, \"\");\n\n    if (options.open) {\n      logMessage(\n        ctx,\n        chalk.gray(`Opening ${loginUrl} in the default browser...`),\n      );\n      await open(loginUrl);\n    } else {\n      console.log(loginUrl);\n    }\n  });\n\nexport async function deploymentDashboardUrlPage(\n  ctx: Context,\n  configuredDeployment: string | null,\n  page: string,\n): Promise<string> {\n  if (configuredDeployment !== null) {\n    const { team, project } = await fetchTeamAndProject(\n      ctx,\n      configuredDeployment,\n    );\n    return deploymentDashboardUrl(team, project, configuredDeployment) + page;\n  } else {\n    // If there is no configured deployment, go to the most recently opened deployment.\n    return `${DASHBOARD_HOST}/deployment/${page}`;\n  }\n}\n\nexport function deploymentDashboardUrl(\n  team: string,\n  project: string,\n  deploymentName: string,\n) {\n  return `${projectDashboardUrl(team, project)}/${deploymentName}`;\n}\n\nexport function projectDashboardUrl(team: string, project: string) {\n  return `${teamDashboardUrl(team)}/${project}`;\n}\n\nexport function teamDashboardUrl(team: string) {\n  return `${DASHBOARD_HOST}/t/${team}`;\n}\n"],
  "mappings": ";AAAA,OAAO,WAAW;AAClB,OAAO,UAAU;AACjB;AAAA,EAEE;AAAA,EACA;AAAA,EACA;AAAA,OACK;AACP;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,OACK;AACP,SAAS,eAAe;AACxB,SAAS,yBAAyB;AAElC,MAAM,iBAAiB,QAAQ,IAAI,wBAC/B,0BACA;AAEG,aAAM,YAAY,IAAI,QAAQ,WAAW,EAC7C,YAAY,mCAAmC,EAC/C;AAAA,EACC;AAAA,EACA;AACF,EACC,8BAA8B,kBAAkB,wBAAwB,CAAC,EACzE,mBAAmB,EACnB,OAAO,OAAO,YAAY;AACzB,QAAM,MAAM;AAEZ,QAAM,sBAAsB,+BAA+B,OAAO;AAClE,QAAM,EAAE,eAAe,IAAI,MAAM;AAAA,IAC/B;AAAA,IACA;AAAA,EACF;AAEA,MAAI,mBAAmB,QAAW;AAChC;AAAA,MACE;AAAA,MACA;AAAA,IACF;AACA,WAAO,MAAM,IAAI,MAAM,GAAG,yBAAyB;AAAA,EACrD;AAEA,QAAM,WAAW,MAAM,2BAA2B,KAAK,gBAAgB,EAAE;AAEzE,MAAI,QAAQ,MAAM;AAChB;AAAA,MACE;AAAA,MACA,MAAM,KAAK,WAAW,oCAAoC;AAAA,IAC5D;AACA,UAAM,KAAK,QAAQ;AAAA,EACrB,OAAO;AACL,YAAQ,IAAI,QAAQ;AAAA,EACtB;AACF,CAAC;AAEH,sBAAsB,2BACpB,KACA,sBACA,MACiB;AACjB,MAAI,yBAAyB,MAAM;AACjC,UAAM,EAAE,MAAM,QAAQ,IAAI,MAAM;AAAA,MAC9B;AAAA,MACA;AAAA,IACF;AACA,WAAO,uBAAuB,MAAM,SAAS,oBAAoB,IAAI;AAAA,EACvE,OAAO;AAEL,WAAO,GAAG,6BAA6B;AAAA,EACzC;AACF;AAEO,gBAAS,uBACd,MACA,SACA,gBACA;AACA,SAAO,GAAG,oBAAoB,MAAM,OAAO,KAAK;AAClD;AAEO,gBAAS,oBAAoB,MAAc,SAAiB;AACjE,SAAO,GAAG,iBAAiB,IAAI,KAAK;AACtC;AAEO,gBAAS,iBAAiB,MAAc;AAC7C,SAAO,GAAG,oBAAoB;AAChC;",
  "names": []
}
